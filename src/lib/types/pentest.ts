import { Timestamp } from "firebase-admin/firestore";

// Activity types for logging
export type ActivityType =
  | "manual_test"
  | "ai_scan"
  | "nmap_scan"
  | "openvas_scan"
  | "zap_scan"
  | "finding_added"
  | "report_generated"
  | "target_added"
  | "engagement_started"
  | "engagement_completed";

export type Severity = "info" | "low" | "medium" | "high" | "critical";

export type EngagementStatus =
  | "planning"
  | "active"
  | "paused"
  | "completed"
  | "archived";

export type FindingStatus =
  | "open"
  | "confirmed"
  | "false_positive"
  | "remediated"
  | "accepted_risk";

// Client/Engagement structure for organizing pentests
export interface Engagement {
  id: string;
  clientName: string;
  projectName: string;
  status: EngagementStatus;
  startDate: Timestamp;
  endDate?: Timestamp;
  scope: string[]; // Target domains/IPs in scope
  outOfScope?: string[];
  notes?: string;
  createdBy: string; // userId
  createdAt: Timestamp;
  updatedAt?: Timestamp;
}

// Activity Log Entry
export interface ActivityLog {
  id: string;
  userId: string;
  engagementId?: string;
  type: ActivityType;
  title: string;
  description: string;
  target?: string;
  metadata?: Record<string, any>;
  timestamp: Timestamp;
}

// Manual Pentest Entry
export interface ManualTest {
  id: string;
  userId: string;
  engagementId?: string;
  title: string;
  description: string;
  target: string;
  methodology?: string; // e.g., "OWASP", "PTES", "Custom"
  testType: ManualTestType;
  status: "in_progress" | "completed" | "blocked";
  startTime: Timestamp;
  endTime?: Timestamp;
  duration?: number; // minutes
  notes?: string;
  findings?: string[]; // IDs of related findings
  attachments?: Attachment[];
  createdAt: Timestamp;
  updatedAt?: Timestamp;
}

export type ManualTestType =
  | "reconnaissance"
  | "enumeration"
  | "vulnerability_assessment"
  | "exploitation"
  | "post_exploitation"
  | "web_app"
  | "network"
  | "social_engineering"
  | "physical"
  | "wireless"
  | "other";

// Finding/Vulnerability
export interface Finding {
  id: string;
  userId: string;
  engagementId?: string;
  scanId?: string; // If from automated scan
  manualTestId?: string; // If from manual test
  title: string;
  description: string;
  severity: Severity;
  status: FindingStatus;
  target: string;
  affectedComponent?: string;
  cveIds?: string[];
  cvssScore?: number;
  evidence?: string;
  stepsToReproduce?: string;
  remediation?: string;
  references?: string[];
  attachments?: Attachment[];
  discoveredAt: Timestamp;
  confirmedAt?: Timestamp;
  remediatedAt?: Timestamp;
  createdAt: Timestamp;
  updatedAt?: Timestamp;
}

export interface Attachment {
  id: string;
  name: string;
  type: string; // MIME type
  url: string; // Storage URL
  size: number;
  uploadedAt: Timestamp;
}

// AI Pentest Configuration
export interface AIPentestConfig {
  id: string;
  name: string;
  description?: string;
  targets: string[];
  scanTypes: ("nmap" | "openvas" | "zap")[];
  schedule?: {
    enabled: boolean;
    cron?: string; // Cron expression
    lastRun?: Timestamp;
    nextRun?: Timestamp;
  };
  options: {
    nmap?: {
      ports?: string;
      enableScripts?: boolean;
    };
    openvas?: {
      scanConfig?: string;
    };
    zap?: {
      profile?: "quick" | "active" | "full";
    };
  };
  autoGenerateReport?: boolean;
  notifyOnComplete?: boolean;
  createdBy: string;
  createdAt: Timestamp;
  updatedAt?: Timestamp;
}

// AI Pentest Run
export interface AIPentestRun {
  id: string;
  configId: string;
  userId: string;
  engagementId?: string;
  status: "queued" | "running" | "completed" | "failed" | "cancelled";
  startTime: Timestamp;
  endTime?: Timestamp;
  scanIds: string[]; // Individual scan IDs
  progress: {
    total: number;
    completed: number;
    failed: number;
  };
  summary?: {
    targetsScanned: number;
    findingsCount: number;
    criticalCount: number;
    highCount: number;
    mediumCount: number;
    lowCount: number;
  };
  errorMessage?: string;
  createdAt: Timestamp;
}

// Dashboard Stats
export interface PentestStats {
  totalEngagements: number;
  activeEngagements: number;
  totalFindings: number;
  openFindings: number;
  criticalFindings: number;
  highFindings: number;
  totalManualTests: number;
  totalAIScans: number;
  hoursLogged: number;
}
